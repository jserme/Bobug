var Bobug={lang:{}};Bobug.lang.en={log_console:"Log Console",collapse:"Collapse",expand:"Expand",pause:"Pause",clear:"Clear",run:"run",customize:"Custom"};Bobug.lang.zh={log_console:"\u63a7\u5236\u53f0",collapse:"\u6536\u8d77",expand:"\u5c55\u5f00",pause:"\u6682\u505c",clear:"\u6e05\u9664",run:"\u8fd0\u884c",customize:"\u81ea\u5b9a\u4e49"};
(function(f,l){function m(b){this.uid=p++;h(this,b)}var p=0,i=Array.prototype.slice,g=function(b,c){for(var d=0;d<b.length;d++)c(b[d],d)},j=function(b){b.style.display="none"},k=function(b){b.style.display="block"},h=function(){var b=i.call(arguments),c=b.shift();g(b,function(b){for(var e in b)c[e]=b[e]});return c},q=function(b,c,d){b.addEventListener?b.addEventListener(c,d,!1):b.attachEvent("on"+c,function(){d.call(b)})},n=function(b,c){if(!c)return!1;var d={},d=!/\W/.test(b)?d[b]=d[b]||mstmpl(document.getElementById(b).innerHTML):
new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+b.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return c?d(c):d};m.prototype={_logs:[],run:function(b){var c="log",d;try{d=eval("("+b+")")}catch(e){d=e,c="error"}this.log([b,"<br/>",d].join(""),c,"Bobug Run")},putLog:function(){if(this._paused)return!1;
var b=i.call(arguments),c=this;g(b,function(b){c.limit&&c._logs.length==c.limit&&a.shift();c._logs.push(b);c.filter(b)&&c.fire("put",b)})},sort:function(b){return this._logs.sort(b)},_filters:[],addFilter:function(b,c){this._filters.push({type:b,func:c})},removeFilter:function(b){var c=[];g(this._filters,function(d){d.type!==b&&c.push(d)});this._filters=[]},filter:function(b){var c=!0;g(this._filters,function(d){d.func(b)&&(c=!1)});return c},getLogs:function(b,c){for(var d=[],e=this._logs.length,
b=b>e?e:b,e=e-1;0<=e&&0!=b;e--)c(this._logs[e])&&(d.push(this._logs[e]),b--);return d},pause:function(){this._paused=!0},start:function(){this._paused=!1},clear:function(){this._logs=[];this.fire("clear")},log:function(b,c,d){var e=new Date;this.putLog({msg:b+"",catalog:c,source:d,_time:[[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-"),[e.getHours(),e.getMinutes(),e.getSeconds()].join(":"),e.getMilliseconds()].join(" ")})},_evts:[],fire:function(){var b=i.call(arguments),c=b.shift(),d=this;
g(this._evts,function(e){e.e==c&&e.f.apply(d,b)})},each:function(b){g(this._logs,function(c,d){b(c,d)})},on:function(b,c){this._evts.push({e:b,f:c})}};var o=function(b){h(this,b);this.init()};o.prototype={isRender:!1,isShow:!1,isExpland:!0,el:null,init:function(){var b=this;this.model.on("put",function(c){b.appendLog(c)});this.model.on("clear",function(){b.clear()})},appendLog:function(b){if(!this.isRender)return!1;var c=this.getEl("console"),d=document.createElement("div");d.className="bobug-console-entry bobug-console-entry-"+
b.catalog;d.innerHTML=n(this.templates.entry,b);c.appendChild(d);d.scrollIntoView()},templates:{box:'<div id="bobug_<%=uid%>" class="bobug-console-content">                    <div class="bobug-console-hd">                        <h4 class="bobug-console-title">                            <%=Lang.log_console%>                        </h4>                        <input type="button" id="collapse_<%=uid%>" class="bobug-console-button bobug-console-collapse" value="<%=Lang.collapse%>" />                    </div>                    <div class="bobug-console-bd" style="height: 258px; " id="console_<%=uid%>">                    </div>                    <div class="bobug-console-command"  id="command_<%=uid%>">                        <textarea id="cmd_<%=uid%>" ></textarea>                    </div>                    <div class="bobug-console-ft" id="footer_<%=uid%>">                        <div class="bobug-console-controls">                            <label for="pause_<%=uid%>" class="bobug-console-pause-label">                                <input type="checkbox" class="bobug-console-checkbox bobug-console-pause" value="1" id="pause_<%=uid%>">                                <%=Lang.pause%>                            </label>                            <input type="button" value="<%=Lang.run%>" class="bobug-console-button bobug-console-run " id="run_<%=uid%>">                            <button type="button" id="clear_<%=uid%>" class="bobug-console-button bobug-console-clear">                                <%=Lang.clear%>                            </button>                        </div>                        <div class="bobug-console-filters-categories" id="catalog_<%=uid%>">                            <label class="bobug-console-filter-label">                                <input type="checkbox" id="info_<%=uid%>"  value="info" checked  class="bobug-console-filter bobug-console-filter-info">                                info                            </label>                            <label class="bobug-console-filter-label">                                <input type="checkbox" id="error_<%=uid%>"  value="error" checked class="bobug-console-filter bobug-console-filter-error">                                error                            </label>                            <label class="bobug-console-filter-label">                                <input type="checkbox" id="warn_<%=uid%>"  value="warn" checked class="bobug-console-filter bobug-console-filter-warn">                                warn                            </label>                            <label class="bobug-console-filter-label">                                <input type="input" id="custom_<%=uid%>"  placeholder="<%=Lang.customize%>" value="" class="bobug-console-filter-custom">                            </label>                        </div>                    </div>                </div>',
entry:'<p class="bobug-console-entry-meta">                            <span class="bobug-console-entry-src"><%=source%></span>                            <span class="bobug-console-entry-cat"><%=catalog%></span>                            <span class="bobug-console-entry-time"><%=_time%></span>                        </p>                        <pre class="bobug-console-entry-content"><%=msg%></pre>'},events:{"click pause":"togglePause","click run":"runCommand","click info":"filterInfo","click error":"filterError",
"click warn":"filterWarn","keyup custom":"filterCustom","click clear":"clear","click collapse":"togglePanel","keydown command":"canRun"},eventsFuncBuilder:function(){var b=this;b.togglePause=function(){this.checked?b.model.pause():b.model.start()};b.togglePanel=function(){b.isExpland?(j(b.getEl("console")),j(b.getEl("command")),j(b.getEl("footer")),this.value=b.model.Lang.expand,b.isExpland=!1):(k(b.getEl("console")),k(b.getEl("command")),k(b.getEl("footer")),this.value=b.model.Lang.collapse,b.getEl("console").lastChild&&
b.getEl("console").lastChild.scrollIntoView(),b.isExpland=!0)};b.runCommand=function(){var c=b.getEl("cmd").value;b.model.run(c)};b.canRun=function(c){c=c||window.event;if(c.ctrlKey&&13==c.keyCode)return c.preventDefault(),b.runCommand(),!1};b.filterInfo=function(){!this.checked?b.model.addFilter("filterInfo",function(b){return"info"==b.catalog?!0:!1}):b.model.removeFilter("filterInfo");b.reRenderLogs()};b.filterError=function(){!this.checked?b.model.addFilter("filterError",function(b){return"error"==
b.catalog?!0:!1}):b.model.removeFilter("filterError");b.reRenderLogs()};b.filterWarn=function(){!this.checked?b.model.addFilter("filterWarn",function(b){return"warn"==b.catalog?!0:!1}):b.model.removeFilter("filterWarn");b.reRenderLogs()};b.filterCustom=function(){var c=this.value.replace(/^\s*|\s*$/g,"");console.log(c);c?b.model.addFilter("filterCustomStr",function(b){return-1==b.msg.indexOf(c)?!0:!1}):b.model.removeFilter("filterCustomStr");b.reRenderLogs()};b.clear=function(){b.getEl("console").innerHTML=
""}},getEl:function(b){return"string"==typeof(b+"_"+this.model.uid)?document.getElementById(b+"_"+this.model.uid):b+"_"+this.model.uid},reRenderLogs:function(){this.clear();var b=this;this.model.each(function(c){b.model.filter(c)&&b.appendLog(c)});b.getEl("console").lastChild&&b.getEl("console").lastChild.scrollIntoView()},delegateEvents:function(){var b,c;this.eventsFuncBuilder();for(var d in this.events)b=d.split(" ")[0],c=this.getEl(d.split(" ")[1]),q(c,b,this[this.events[d]])},show:function(){this.render();
k(this.el);this.isShow=!0},hide:function(){j(this.el);this.isShow=!1},render:function(){if(this.isRender)return!1;this.el||(this.el=document.createElement("div"));this.el.style.cssText="width:500px;display:none";this.el.innerHTML=n(this.templates.box,this.model);this.isRender=!0;this.container||(this.container=document.body);this.container.appendChild(this.el);this.delegateEvents()}};f.model=new m({limit:200});f.view=new o({model:f.model});h(f,{show:function(){this.view.show()},hide:function(){this.view.hide()},
log:function(b,c,d){this.model.log(b,c||"log",d||"Bobug")},info:function(b,c){this.log(b,"info",c||"Bobug")},warn:function(b,c){this.log(b,"warn",c||"Bobug")},error:function(b,c){this.log(b,"error",c||"Bobug")},setLang:function(b){h(this.model,{Lang:h({},f.lang[b])})},getLogs:function(){var b=i.call(arguments),c=b.shift(),d=b.shift(),e=b.shift(),f;d==l&&(f=function(){return!0});"function"==typeof d?f=d:"string"==typeof d&&(f=function(b){return b.catalog==d?!0:!1});e!=l&&(f=function(b){return b.catalog==
d&&b.source==e?!0:!1});return this.model.getLogs(c,f)},run:function(b){this.model.run(b)},clear:function(){this.model.clear(str)},loadJs:function(b){var c=document.createElement("script");c.src=b;document.head.insertBefore(c,document.head.lastChild)}});f.setLang("en")})(Bobug);
